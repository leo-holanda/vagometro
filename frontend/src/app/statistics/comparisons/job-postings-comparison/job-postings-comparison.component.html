<ng-container *ngIf="monthlyComparativeData$ | async as monthlyData; else loading">
  <div class="card bg-base-300 w-full">
    <div class="card-body">
      <h2 class="card-title justify-between flex-wrap gap-4">
        <div>
          <i class="bx bxs-chart"></i>
          Comparativo
          {{
            comparisonType === comparisonTypes.monthly
              ? "Mensal"
              : comparisonType === comparisonTypes.quarterly
                ? "Trimestral"
                : "Anual"
          }}
        </div>

        <section class="flex flex-col gap-2">
          <div class="flex flex-wrap gap-2">
            <button
              [ngClass]="{
                'btn-active': comparisonType === comparisonTypes.monthly
              }"
              (click)="onComparisonTypeClick(comparisonTypes.monthly)"
              class="btn btn-outline"
            >
              Ver mensalmente
            </button>

            <button
              [ngClass]="{
                'btn-active': comparisonType === comparisonTypes.quarterly
              }"
              (click)="onComparisonTypeClick(comparisonTypes.quarterly)"
              class="btn btn-outline"
            >
              Ver trimestralmente
            </button>

            <button
              [ngClass]="{
                'btn-active': comparisonType === comparisonTypes.annual
              }"
              (click)="onComparisonTypeClick(comparisonTypes.annual)"
              class="btn btn-outline"
            >
              Ver anualmente
            </button>
          </div>
        </section>
      </h2>

      <div class="overflow-x-auto max-h-96 mt-4">
        <ng-container *ngIf="comparisonType === comparisonTypes.monthly">
          <table class="table table-sm table-zebra table-pin-rows">
            <thead>
              <tr>
                <th>Mês</th>
                <th>Vagas</th>
                <th>Diferença</th>
                <th>Diferença (%)</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let month of monthlyData; index as i; trackBy: trackByComparisonData">
                <td>{{ month.name | titlecase }}</td>
                <td>{{ month.count | number }}</td>
                <td
                  [ngClass]="{
                    'text-green-500': month.difference > 0,
                    'text-red-500': month.difference < 0
                  }"
                >
                  {{
                    month.difference > 0
                      ? "+" + (month.difference | number)
                      : (month.difference | number)
                  }}
                </td>
                <td
                  [ngClass]="{
                    'text-green-500': month.difference > 0,
                    'text-red-500': month.difference < 0
                  }"
                >
                  {{
                    (month.differenceAsPercentage > 0
                      ? "+" + (month.differenceAsPercentage | number: "1.2-2")
                      : (month.differenceAsPercentage | number: "1.2-2")) + "%"
                  }}
                </td>
              </tr>
            </tbody>
          </table>
        </ng-container>

        <ng-container *ngIf="comparisonType === comparisonTypes.quarterly">
          <table class="table table-sm table-zebra table-pin-rows">
            <thead>
              <tr>
                <th>Trimestre</th>
                <th>Vagas</th>
                <th>Diferença</th>
                <th>Diferença (%)</th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="
                  let quarter of quarterlyComparativeData$ | async;
                  index as i;
                  trackBy: trackByComparisonData
                "
              >
                <td>{{ quarter.name | titlecase }}</td>
                <td>{{ quarter.count | number }}</td>
                <td
                  [ngClass]="{
                    'text-green-500': quarter.difference > 0,
                    'text-red-500': quarter.difference < 0
                  }"
                >
                  {{
                    quarter.difference > 0
                      ? "+" + (quarter.difference | number)
                      : (quarter.difference | number)
                  }}
                </td>
                <td
                  [ngClass]="{
                    'text-green-500': quarter.difference > 0,
                    'text-red-500': quarter.difference < 0
                  }"
                >
                  {{
                    (quarter.differenceAsPercentage > 0
                      ? "+" + (quarter.differenceAsPercentage | number: "1.2-2")
                      : (quarter.differenceAsPercentage | number: "1.2-2")) + "%"
                  }}
                </td>
              </tr>
            </tbody>
          </table>
        </ng-container>

        <ng-container *ngIf="comparisonType === comparisonTypes.annual">
          <table class="table table-sm table-zebra table-pin-rows">
            <thead>
              <tr>
                <th>Mês</th>
                <th>Vagas</th>
                <th>Diferença</th>
                <th>Diferença (%)</th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="
                  let annual of annualComparativeData$ | async;
                  index as i;
                  trackBy: trackByComparisonData
                "
              >
                <td>{{ annual.name | titlecase }}</td>
                <td>{{ annual.count | number }}</td>
                <td
                  [ngClass]="{
                    'text-green-500': annual.difference > 0,
                    'text-red-500': annual.difference < 0
                  }"
                >
                  {{
                    annual.difference > 0
                      ? "+" + (annual.difference | number)
                      : (annual.difference | number)
                  }}
                </td>
                <td
                  [ngClass]="{
                    'text-green-500': annual.difference > 0,
                    'text-red-500': annual.difference < 0
                  }"
                >
                  {{
                    (annual.differenceAsPercentage > 0
                      ? "+" + (annual.differenceAsPercentage | number: "1.2-2")
                      : (annual.differenceAsPercentage | number: "1.2-2")) + "%"
                  }}
                </td>
              </tr>
            </tbody>
          </table>
        </ng-container>
      </div>
    </div>
  </div>
</ng-container>

<ng-template #loading>
  <div class="flex flex-col w-full gap-4 my-4">
    <div class="skeleton h-8 w-full"></div>
    <div class="skeleton h-8 w-full"></div>
    <div class="skeleton h-8 w-full"></div>
    <div class="skeleton h-8 w-full"></div>
    <div class="skeleton h-8 w-full"></div>
  </div>
</ng-template>
